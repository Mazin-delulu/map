<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Báº£n Ä‘á»“ nghiÃªn cá»©u sinh váº­t biá»ƒn</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    #map {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* Sidebar cho PC */
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 300px;
      height: 100%;
      background: #f8f9fa;
      border-right: 1px solid #ccc;
      overflow-y: auto;
      padding: 15px;
      box-sizing: border-box;
      transform: translateX(0);
      transition: transform 0.3s ease;
      z-index: 1002;
    }

    #sidebar.collapsed {
      transform: translateX(-100%);
    }

    /* NÃºt toggle sidebar (PC) */
    #toggleSidebar {
      position: fixed;
      top: 20px;
      left: 10px;
      background: #0d6efd;
      color: white;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      z-index: 1100;
      user-select: none;
    }

    #toggleSidebar:hover {
      background: #0b5ed7;
    }

    h2 {
      font-size: 18px;
      margin-top: 0;
      color: #333;
      text-align: center;
    }

    .region-item {
      margin-bottom: 10px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }

    label {
      cursor: pointer;
      font-size: 14px;
      color: #333;
    }

    .popup-title {
      font-weight: bold;
      font-size: 14px;
      color: #1a237e;
    }

    /* ðŸ“± Giao diá»‡n cho Ä‘iá»‡n thoáº¡i */
    @media (max-width: 768px) {
      #sidebar {
        display: none;
      }

      #toggleSidebar {
        display: none !important;
      }

      /* NÃºt má»Ÿ danh sÃ¡ch */
      #mobileButton {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #0d6efd;
        color: white;
        padding: 12px 18px;
        border-radius: 25px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.25);
        font-size: 14px;
        z-index: 1500;
        cursor: pointer;
        border: none;
      }

      /* Popup vÃ¹ng nghiÃªn cá»©u trÃªn mobile */
      #mobilePopup {
        position: fixed;
        bottom: -100%;
        left: 0;
        width: 100%;
        height: 60%;
        background: #fff;
        box-shadow: 0 -2px 15px rgba(0,0,0,0.3);
        border-radius: 15px 15px 0 0;
        transition: bottom 0.3s ease;
        z-index: 2000;
        display: flex;
        flex-direction: column;
      }

      #mobilePopup.active {
        bottom: 0;
      }

      #mobilePopupHeader {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        border-bottom: 1px solid #ddd;
        background: #f8f9fa;
        border-radius: 15px 15px 0 0;
      }

      #mobilePopupHeader h2 {
        font-size: 16px;
        margin: 0;
      }

      #mobilePopupHeader button {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
      }

      #mobileRegionList {
        flex: 1;
        overflow-y: auto;
        padding: 10px 20px;
      }
    }

    /* Popup con (tÃ i liá»‡u) */
    .file-group { position: relative; margin-bottom: 6px; }
    .file-group-title {
      background: #eef3ff;
      color: #0d6efd;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
      display: inline-block;
      transition: background 0.2s;
    }
    .file-group-title:hover { background: #dbe7ff; }

    .leaflet-control-zoom {
      position: fixed !important;
      top: 20px !important;
      right: 20px !important;
      z-index: 1200 !important;
    }
  </style>
</head>
<body>
  <!-- Sidebar cho PC -->
  <div id="sidebar" class="collapsed">
    <h2>VÃ¹ng nghiÃªn cá»©u</h2>
    <div id="regionList"></div>
  </div>

  <div id="toggleSidebar">â€º</div>

  <!-- NÃºt má»Ÿ danh sÃ¡ch cho Mobile -->
  <button id="mobileButton">ðŸ“‹ Danh sÃ¡ch vÃ¹ng nghiÃªn cá»©u</button>

  <!-- Popup vÃ¹ng nghiÃªn cá»©u (Mobile) -->
  <div id="mobilePopup">
    <div id="mobilePopupHeader">
      <h2>VÃ¹ng nghiÃªn cá»©u</h2>
      <button id="closeMobilePopup">âœ–</button>
    </div>
    <div id="mobileRegionList"></div>
  </div>

  <div id="map"></div>

  <script>
  const map = L.map("map").setView([16.0471, 108.2068], 6);
  map.zoomControl.setPosition('topright');

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 18,
    attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
  }).addTo(map);

  const sidebar = document.getElementById("sidebar");
  const toggleBtn = document.getElementById("toggleSidebar");
  const mobileButton = document.getElementById("mobileButton");
  const mobilePopup = document.getElementById("mobilePopup");
  const closeMobilePopup = document.getElementById("closeMobilePopup");

  toggleBtn.addEventListener("click", () => {
    sidebar.classList.toggle("collapsed");
    const isCollapsed = sidebar.classList.contains("collapsed");
    toggleBtn.innerHTML = isCollapsed ? "â€º" : "â€¹";
    toggleBtn.style.left = isCollapsed ? "10px" : "280px";
    map.invalidateSize({ pan: false });
  });

  mobileButton.addEventListener("click", () => {
    mobilePopup.classList.add("active");
  });

  closeMobilePopup.addEventListener("click", () => {
    mobilePopup.classList.remove("active");
  });

  function createSVGIcon(color = "#0d6efd") {
    const svg = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        fill="${color}" width="32" height="32">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13
        c0-3.87-3.13-7-7-7zm0 9.5c-1.38
        0-2.5-1.12-2.5-2.5s1.12-2.5
        2.5-2.5 2.5 1.12 2.5 2.5
        -1.12 2.5-2.5 2.5z"/>
      </svg>`;
    return L.divIcon({
      html: svg,
      className: "custom-marker",
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -28]
    });
  }

  const regionMarkers = {};
  const mainMarkers = {};

  fetch("./data_nghiencuu.json")
    .then(res => res.json())
    .then(data => {
      const regionList = document.getElementById("regionList");
      const mobileRegionList = document.getElementById("mobileRegionList");

      data.forEach(region => {
        const { region: name, year, representative } = region;
        const color = "#" + Math.floor(Math.random() * 16777215).toString(16);

        const centerMarker = L.marker([representative.lat, representative.lon], {
          icon: createSVGIcon(color)
        }).addTo(map);
        mainMarkers[name] = centerMarker;

        const div = document.createElement("div");
        div.className = "region-item";
        div.innerHTML = `
          <label>
            <input type="checkbox" data-region="${name}">
            <strong style="color:${color}">${name}</strong> (${year ?? "N/A"})
          </label>`;

        const clone = div.cloneNode(true);
        regionList.appendChild(div);
        mobileRegionList.appendChild(clone);
      });
    })
    .catch(err => console.error("Lá»—i khi táº£i JSON:", err));

  setTimeout(() => map.invalidateSize(), 800);
  </script>
</body>
</html>
